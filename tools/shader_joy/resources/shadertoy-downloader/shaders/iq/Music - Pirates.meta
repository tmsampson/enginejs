{
	"Shader": {
		"ver": "0.1",
		"info": {
			"id": "ldXXDj",
			"date": "1406802116",
			"viewed": 21293,
			"name": "Music - Pirates",
			"username": "iq",
			"description": "An improvement on the music sequencing strategy, much better than that used in the Mario shader. This one supports polyphony (within the same channel) and is much more compact (which means that it does compile)",
			"likes": 135,
			"published": 3,
			"flags": 8,
			"tags": [
				"procedural",
				"2d",
				"sound",
				"music"
			],
			"hasliked": 0
		},
		"renderpass": [
			{
				"inputs": [
					{
						"id": 4,
						"src": "/presets/tex03.jpg",
						"ctype": "texture",
						"channel": 0
					},
					{
						"id": 17,
						"src": "/presets/tex12.png",
						"ctype": "texture",
						"channel": 1
					}
				],
				"outputs": [
					{
						"channel": "0",
						"dst": "-1"
					},
					{
						"channel": "0",
						"dst": "-1"
					}
				],
				"code": "",
				"name": "",
				"description": "",
				"type": "image"
			},
			{
				"inputs": [],
				"outputs": [],
				"code": "// Created by inigo quilez - iq/2014\n// License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n\n//----------------------------------------------------------------------------------------\n// main instrument\nfloat instrument( float freq, float time )\n{\n    freq = 440.0*pow(freq/440.0,1.003); // spread\n    \n    float ph = 1.0;\n    ph *= sin(6.2831*freq*time);\n    ph *= 0.2+0.8*max(0.0,6.0-0.01*freq);\n    ph *= exp(-time*freq*0.2);\n    \n    float y = 0.0;\n    y += 0.70*sin(1.00*6.2831*freq*time+ph)*exp(-0.5*0.007*freq*time);\n    y += 0.20*sin(2.01*6.2831*freq*time+ph)*exp(-0.5*0.011*freq*time);\n    y += 0.20*sin(3.01*6.2831*freq*time+ph)*exp(-0.5*0.015*freq*time);\n    y += 0.16*sin(4.01*6.2831*freq*time+ph)*exp(-0.5*0.018*freq*time);\n    y += 0.13*sin(5.01*6.2831*freq*time+ph)*exp(-0.5*0.021*freq*time);\n    y += 0.10*sin(6.01*6.2831*freq*time+ph)*exp(-0.5*0.027*freq*time);\n    y += 0.09*sin(8.01*6.2831*freq*time+ph)*exp(-0.5*0.030*freq*time);\n    y += 0.07*sin(9.01*6.2831*freq*time+ph)*exp(-0.5*0.033*freq*time);\n\n    y += 0.45*y*y*y;\n       \n    y *= 1.0 + 1.5*exp(-8.0*time);\n    y *= clamp( time/0.004, 0.0, 1.0 );\n\n    y *= 2.5-1.5*clamp( log2(freq)/10.0,0.0,1.0);\n\treturn y;\t\n}\n\n\n// music data\nfloat doChannel1( float soundTime );\nfloat doChannel2( float soundTime );\n\n//----------------------------------------------------------------------------------------\n// sound shader entrypoint\n//\n// input: time in seconds\n// ouput: stereo wave valuie at \"time\"\n//----------------------------------------------------------------------------------------\n\nvec2 mainSound( float time )\n{\t\n    time = mod( time, 60.0 );\n    \n    vec2 y = vec2(0.0);\n    y += vec2(0.7,0.3)*doChannel1( time ); // main instrument\n    y += vec2(0.3,0.7)*doChannel2( time ); // secondary instrument\n\ty *= 0.1;\n    \n\treturn y;\n}\n\n//----------------------------------------------------------------------------------------\n\n#define D(a) b+=float(a);if(t>b)x=b;\n\n//----------------------------------------------------------------------------------------\n\n#define tint 0.144\n\nfloat doChannel1( float t )\n{\n  float x = 0.0;\n  float y = 0.0;\n  float b = 0.0;\n  t /= tint;\n\n  // F2\n  x = t; b = 0.0;\n  D(36)D(2)D(2)D(20)D(2)D(16)D(6)D(2)D(226)\n  y += instrument( 174.0, tint*(t-x) );\n\n  // G2\n  x = t; b = 0.0;\n  D(53)D(208)\n  y += instrument( 195.0, tint*(t-x) );\n\n  // A2\n  x = t; b = 0.0;\n  D(34)D(2)D(2)D(2)D(1)D(7)D(2)D(2)D(2)D(1)D(3)D(8)D(2)D(8)D(2)D(4)D(2)D(2)D(2)D(1)\n  D(31)D(2)D(4)D(138)D(46)D(2)\n  y += instrument( 220.0, tint*(t-x) );\n\n  // A#2\n  x = t; b = 0.0;\n  D(42)D(2)D(2)D(14)D(2)D(2)D(1)D(25)D(2)D(16)D(2)D(2)\n  y += instrument( 233.0, tint*(t-x) );\n\n  // B2\n  x = t; b = 0.0;\n  D(125)\n  y += instrument( 246.0, tint*(t-x) );\n\n  // C3\n  x = t; b = 0.0;\n  D(35)D(6)D(7)D(2)D(3)D(1)D(5)D(7)D(2)D(2)D(1)D(1)D(2)D(3)D(6)D(199)D(2)D(2)D(2)D(1)\n  y += instrument( 261.0, tint*(t-x) );\n\n  // C#3\n  x = t; b = 0.0;\n  D(120)D(2)D(4)D(132)D(1)D(5)D(42)D(2)\n  y += instrument( 277.0, tint*(t-x) );\n\n  // D3\n  x = t; b = 0.0;\n  D(0)D(2)D(1)D(2)D(1)D(2)D(1)D(1)D(1)D(1)D(2)D(1)D(2)D(1)D(2)D(1)D(1)D(1)D(1)D(2)\n  D(1)D(2)D(1)D(2)D(1)D(3)D(2)D(2)D(2)D(2)D(2)D(1)D(5)D(3)D(5)D(2)D(2)D(12)D(2)D(6)\n  D(2)D(2)D(2)D(2)D(2)D(1)D(1)D(2)D(5)D(3)D(2)D(2)D(2)D(3)D(3)D(6)D(1)D(136)D(9)D(2)\n  D(2)D(2)D(1)D(17)D(2)D(2)D(2)D(1)D(11)\n  y += instrument( 293.0, tint*(t-x) );\n\n  // E3\n  x = t; b = 0.0;\n  D(41)D(7)D(2)D(15)D(7)D(2)D(27)D(6)D(13)D(2)D(4)D(132)D(1)D(23)D(2)D(2)D(2)D(18)D(4)\n  y += instrument( 329.0, tint*(t-x) );\n\n  // F3\n  x = t; b = 0.0;\n  D(42)D(2)D(2)D(20)D(2)D(2)D(19)D(11)D(2)D(6)D(2)D(4)D(5)D(5)D(8)D(2)D(2)D(20)D(2)D(16)\n  D(6)D(2)D(82)D(4)D(2)D(2)D(2)D(2)D(1)D(12)D(5)D(2)D(2)D(2)D(1)D(7)\n  y += instrument( 349.0, tint*(t-x) );\n\n  // G3\n  x = t; b = 0.0;\n  D(47)D(24)D(19)D(2)D(2)D(2)D(2)D(3)D(11)D(37)D(120)D(13)D(2)D(2)D(2)D(18)\n  y += instrument( 391.0, tint*(t-x) );\n\n  // A3\n  x = t; b = 0.0;\n  D(95)D(5)D(2)D(12)D(16)D(2)D(2)D(2)D(1)D(7)D(2)D(2)D(2)D(1)D(3)D(8)D(2)D(8)D(2)D(4)\n  D(2)D(2)D(2)D(1)D(31)D(2)D(4)D(2)D(2)D(12)D(1)D(1)D(30)D(2)D(2)D(3)D(12)D(5)D(2)D(2)\n  D(3)\n  y += instrument( 440.0, tint*(t-x) );\n\n  // A#3\n  x = t; b = 0.0;\n  D(96)D(2)D(40)D(2)D(2)D(14)D(2)D(2)D(1)D(25)D(2)D(16)D(2)D(2)D(24)D(18)D(1)D(1)D(24)D(24)\n  y += instrument( 466.0, tint*(t-x) );\n\n  // C4\n  x = t; b = 0.0;\n  D(131)D(6)D(7)D(2)D(3)D(1)D(5)D(7)D(2)D(2)D(1)D(1)D(2)D(3)D(6)D(47)D(2)\n  y += instrument( 523.0, tint*(t-x) );\n\n  // C#4\n  x = t; b = 0.0;\n  D(216)D(2)D(3)\n  y += instrument( 554.0, tint*(t-x) );\n\n  // D4\n  x = t; b = 0.0;\n  D(132)D(2)D(2)D(2)D(2)D(2)D(1)D(5)D(3)D(5)D(2)D(2)D(12)D(2)D(6)D(2)D(2)D(2)D(2)D(2)\n  D(1)D(1)D(2)D(5)D(3)D(2)D(2)D(2)D(3)D(3)D(6)D(2)D(2)D(4)D(4)D(2)D(5)D(7)D(5)\n  y += instrument( 587.0, tint*(t-x) );\n\n  // E4\n  x = t; b = 0.0;\n  D(137)D(7)D(2)D(15)D(7)D(2)D(27)D(6)D(13)D(2)D(8)\n  y += instrument( 659.0, tint*(t-x) );\n\n  // F4\n  x = t; b = 0.0;\n  D(138)D(2)D(2)D(20)D(2)D(2)D(19)D(11)D(2)D(6)D(2)D(4)D(5)D(13)D(2)D(1)D(4)D(3)\n  y += instrument( 698.0, tint*(t-x) );\n\n  // G4\n  x = t; b = 0.0;\n  D(143)D(24)D(19)D(2)D(2)D(2)D(2)D(3)D(11)D(24)D(14)D(4)\n  y += instrument( 783.0, tint*(t-x) );\n\n  // A4\n  x = t; b = 0.0;\n  D(191)D(5)D(2)D(12)D(24)\n  y += instrument( 880.0, tint*(t-x) );\n\n  // A#4\n  x = t; b = 0.0;\n  D(192)D(2)D(52)\n  y += instrument( 932.0, tint*(t-x) );\n\n  // C5\n  x = t; b = 0.0;\n  y += instrument( 1046.0, tint*(t-x) );\n  return y;\n}\n\nfloat doChannel2( float t )\n{\n  float x = 0.0;\n  float y = 0.0;\n  float b = 0.0;\n  t /= tint;\n\n  // D0\n  x = t; b = 0.0;\n  D(24)D(6)D(3)\n  y += instrument( 36.0, tint*(t-x) );\n\n  // F0\n  x = t; b = 0.0;\n  D(66)D(2)D(1)D(2)D(91)D(2)D(1)D(2)\n  y += instrument( 43.0, tint*(t-x) );\n\n  // G0\n  x = t; b = 0.0;\n  D(96)D(2)D(1)D(2)D(91)D(2)D(1)D(2)D(49)D(2)D(1)D(2)D(1)D(2)D(1)D(2)\n  y += instrument( 48.0, tint*(t-x) );\n\n  // A0\n  x = t; b = 0.0;\n  D(48)D(2)D(1)D(2)D(22)D(2)D(43)D(2)D(1)D(2)D(1)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(22)D(2)\n  D(43)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(1)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(1)D(2)D(1)D(2)\n  D(37)D(2)D(1)D(2)\n  y += instrument( 55.0, tint*(t-x) );\n\n  // A#0\n  x = t; b = 0.0;\n  D(42)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(25)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(25)D(2)D(1)D(2)\n  D(13)D(2)D(1)D(2)D(25)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(23)\n  y += instrument( 58.0, tint*(t-x) );\n\n  // C1\n  x = t; b = 0.0;\n  D(41)D(31)D(2)D(63)D(31)D(2)D(56)D(2)D(2)D(52)D(2)D(1)D(2)\n  y += instrument( 65.0, tint*(t-x) );\n\n  // D1\n  x = t; b = 0.0;\n  D(24)D(6)D(3)D(3)D(2)D(1)D(15)D(2)D(1)D(2)D(19)D(2)D(1)D(2)D(1)D(2)D(1)D(2)D(13)D(2)\n  D(1)D(2)D(7)D(2)D(1)D(2)D(13)D(2)D(1)D(15)D(2)D(1)D(2)D(19)D(2)D(1)D(2)D(1)D(2)D(1)\n  D(2)D(13)D(2)D(1)D(2)D(7)D(2)D(1)D(2)D(7)D(2)D(46)D(2)D(1)D(2)D(1)D(2)D(1)D(1)D(1)\n  D(13)D(2)D(1)D(2)D(1)D(2)D(1)D(1)D(1)D(7)\n  y += instrument( 73.0, tint*(t-x) );\n\n  // F1\n  x = t; b = 0.0;\n  D(66)D(2)D(1)D(2)D(91)D(2)D(1)D(2)D(121)D(2)D(1)D(1)D(1)\n  y += instrument( 87.0, tint*(t-x) );\n\n  // G1\n  x = t; b = 0.0;\n  D(96)D(2)D(1)D(2)D(91)D(2)D(1)D(2)D(49)D(2)D(1)D(2)D(1)D(2)D(1)D(2)\n  y += instrument( 97.0, tint*(t-x) );\n\n  // A1\n  x = t; b = 0.0;\n  D(48)D(2)D(1)D(2)D(22)D(2)D(43)D(2)D(1)D(2)D(1)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(22)D(2)\n  D(43)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(1)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(1)D(2)D(1)D(2)\n  D(37)D(2)D(1)D(2)\n  y += instrument( 110.0, tint*(t-x) );\n\n  // A#1\n  x = t; b = 0.0;\n  D(42)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(25)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(25)D(2)D(1)D(2)\n  D(13)D(2)D(1)D(2)D(25)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(23)\n  y += instrument( 116.0, tint*(t-x) );\n\n  // C2\n  x = t; b = 0.0;\n  D(41)D(31)D(2)D(63)D(31)D(2)D(56)D(2)D(2)D(52)D(2)D(1)D(2)\n  y += instrument( 130.0, tint*(t-x) );\n\n  // D2\n  x = t; b = 0.0;\n  D(36)D(2)D(1)D(15)D(2)D(1)D(2)D(19)D(2)D(1)D(2)D(1)D(2)D(1)D(2)D(13)D(2)D(1)D(2)D(7)\n  D(2)D(1)D(2)D(13)D(2)D(1)D(15)D(2)D(1)D(2)D(19)D(2)D(1)D(2)D(1)D(2)D(1)D(2)D(13)D(2)\n  D(1)D(2)D(7)D(2)D(1)D(2)D(7)D(2)D(46)D(2)D(1)D(2)D(1)D(2)D(1)D(1)D(1)D(13)D(2)D(1)\n  D(2)D(1)D(2)D(1)D(1)D(1)D(7)\n  y += instrument( 146.0, tint*(t-x) );\n\n  // F2\n  x = t; b = 0.0;\n  D(288)D(2)D(1)D(1)D(1)\n  y += instrument( 174.0, tint*(t-x) );\n  return y;\n}\n\n",
				"name": "",
				"description": "",
				"type": "sound"
			}
		]
	}
}